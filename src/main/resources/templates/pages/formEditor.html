<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>DCW</title>
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/gaishu.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/shuju.css}"/>
</head>
<style type="text/css">
    .clearfix:after {
        content: '';
        clear: both;
        display: block;
    }

    a {
        text-decoration: none;
    }

    .text-left {
        text-align: left;
    }

    .field-name {
        height: 35px;
        line-height: 35px;
        font-size: larger;
        overflow: auto;
    }

    .field-des {
        height: 25px;
        line-height: 25px;
        font-weight: lighter;
        font-size: x-small;
        overflow: hidden;
    }

    header {
        background-color: #393D49;
    }

    .msg {
        width: 60px;
        height: 35px;
        border-radius: 3px;
        background-color: #333745;
        position: absolute;
        top: 23px;
        right: 5px;
        display: none;
    }

    .msg p {
        width: 100%;
        line-height: 35px;
        text-align: center;
        color: #fff;
        border-radius: 5px;
        position: relative;
        top: 0;
        left: 0;
    }

    .msg .up-trangle {
        display: block;
        width: 0;
        height: 0;
        border: 8px solid #333745;
        transform: rotateZ(45deg);
        position: absolute;
        top: -4px;
        right: 15px;
    }

    .container {
        box-sizing: border-box;
        width: 960px;
        padding: 0 7px;
        margin: auto;
    }

    nav .container {
        margin: 10px auto;
        margin-bottom: 0;
    }

    .formEditorView {
        height: 600px;
        overflow: auto;
        text-align: center;
    }

    form .banner {
        margin-bottom: 10px;
        border: 1px solid #ccc;
    }

    form .layui-form-item {
        width: 85%;
        margin: auto;
        margin-bottom: 10px;
        border: 1px solid #ccc;
    }

    form .layui-input {
        border: 1px solid #5FB878;
    }

    .add-field .fied-item div {
        padding-left: 20px;
        text-align: left;
        height: 35px;
        line-height: 35px;
        overflow: hidden;
        color: #000000;
        transition: all 0.2s;
    }

    .add-field .fied-item div:hover {
        cursor: pointer;
        color: #009AFF !important;
    }

    .form-container {
        width: 90%;
        padding-bottom: 50px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
    }

    form .layui-form-item {
        border: none !important;
    }

    .add-field .layui-this {
        background-color: #009AFF !important;
        color: #fff !important;
    }

    form .new-line:hover {
        cursor: pointer;
    }

    .formEditorView .active-line {
        background-color: #F2FAFF;
        border: 1px dashed #1E9FFF;
        border-left: none;
        border-right: none;
        border-radius: 5px;
    }

    form .new-line {
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        position: relative;
        top: 0;
        left: 0;
    }

    .fn-area {
        position: absolute;
        bottom: -10px;
        right: 100px;
        background-color: #fff;
        display: none;
    }

    .fn-area .ele-copy,
    .fn-area .ele-del {
        width: 30px;
        height: 30px;
        border-radius: 2px;
    }

    .fn-area .ele-copy:hover,
    .fn-area .ele-del:hover {
        background-color: #D84C29;
        cursor: pointer;
    }

    .formEditorView .active-line .fn-area {
        display: block;
    }

    .active-line .layui-form-item input,
    .active-line .layui-form-item textarea,
    .active-line .layui-form-item select {
        border-color: #9F9F9F;
    }

    .setting-row .pull-left {
        line-height: 30px !important;
    }

    .setting-row input {
        margin-bottom: 0;
    }
</style>
<body>
<header>
    <div class="container">
        <ul class="layui-nav">
            <li class="layui-nav-item">
                <a th:href="@{/form/desktop}">桌面</a>
            </li>
            <li class="layui-nav-item">
                <a th:href="@{/user/userInfo}"><img src="http://t.cn/RCzsdCq" class="layui-nav-img">个人中心</a>
                <dl class="layui-nav-child">
                    <dd>
                        <a th:href="@{/logout}">退出</a>
                    </dd>
                </dl>
            </li>
        </ul>
    </div>
</header>
<nav>
    <div class="layui-tab container">
        <ul class="layui-tab-title">
            <!--概述编辑规则设置发布数据报表-->
            <div th:if="${formDetail!=null}">
                <li><a th:href="@{'/form/myform/'+${formDetail.form.id}}">概述</a></li>
                <li class="la                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           yui-this">
                    编辑
                </li>
                <li><a th:href="@{'/formValue/myFormData/'+${formDetail.form.id}}">数据</a></li>
            </div>
            <div th:if="${formDetail==null}">
                <li>概述</li>
                <li class="layui-this">编辑</li>
                <li>数据</li>
            </div>
        </ul>
        <div class="layui-form-item gform">
            <div class="formright">
                <label class="layui-form-label">发布表单</label>
                <input type="text" id="myForm" th:value="@{'~/form/view/'+${formDetail.form.id}}"
                       class="border-gray"/>
                <i class="layui-icon" onclick="document.getElementById('myForm').select();document.execCommand('Copy');">&#xe64c;</i>
                <a th:href="@{'/form/view/'+${formDetail.form.id}}" target="_blank"><i class="layui-icon">
                    &#xe641;</i></a>
            </div>
        </div>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <div class="layui-container">
                    <div class="layui-row">
                        <div class="layui-col-md8">
                            <section class="formEditorView">
                                <div class="form-container">
                                    <form class="layui-form" id="form">
                                        <div class="banner">
                                            <img th:src="@{/images/20160703224347_e39266@hixlarge.png}"
                                                 style="width: 100%;"/>
                                        </div>
                                        <div th:if="${formDetail!=null}">
                                            <div class="layui-form-item new-line">
                                                <!--<div class="layui-input-block">-->
                                                <input type="text" id="formTitle" required
                                                       th:value="${formDetail.form.title}"
                                                       placeholder="表单名" autocomplete="off" class="layui-input">
                                                <!--</div>-->
                                            </div>
                                            <div class="layui-form-item new-line">
                                                <textarea id="briefText" th:text="${formDetail.form.des}"></textarea>
                                            </div>
                                        </div>
                                        <div th:if="${formDetail==null}">
                                            <div class="layui-form-item new-line">
                                                <!--<div class="layui-input-block">-->
                                                <input type="text" id="formTitle" required
                                                       placeholder="表单名" autocomplete="off" class="layui-input">
                                                <!--</div>-->
                                            </div>
                                            <div class="layui-form-item new-line">
                                                <textarea id="briefText"></textarea>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </section>
                        </div>
                        <div class="layui-col-md4">
                            <section class="add-field">
                                <div class="layui-tab layui-tab-card">
                                    <ul class="layui-tab-title">
                                        <li class="layui-this">添加字段</li>
                                        <li id="editorTab">编辑字段</li>
                                        <!--<li>表单样式</li>-->
                                    </ul>
                                    <div class="layui-tab-content">
                                        <div class="layui-tab-item layui-show">

                                            <div class="layui-row layui-col-space10">
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="singletext">
                                                        <i class="layui-icon">&#xe642;</i>&nbsp;&nbsp;单行文字
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="multitext">
                                                        <i class="layui-icon">&#xe63c;</i>&nbsp;&nbsp;多行文字
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="singleselect">
                                                        <i class="layui-icon">&#xe643;</i>&nbsp;&nbsp;单项选择
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="multiselect">
                                                        <i class="layui-icon">&#xe618;</i>&nbsp;&nbsp;多项选择
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="singlepic">
                                                        <i class="layui-icon">&#xe64a;</i>&nbsp;&nbsp; 图片单选
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="multipic">
                                                        <i class="layui-icon">&#xe634;</i>&nbsp;&nbsp;图片多选
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="singlemat">
                                                        <i class="layui-icon">&#xe62d;</i>&nbsp;&nbsp;矩阵单选
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="mattext">
                                                        <i class="layui-icon">&#xe62a;</i>&nbsp;&nbsp; 矩阵填空
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="numberfield">
                                                        <i class="layui-icon" style="font-size: xx-small;">123</i>&nbsp;&nbsp;数字
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="timepicker">
                                                        <i class="layui-icon">&#xe60e;</i>&nbsp;&nbsp;时间
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="datepicker">
                                                        <i class="layui-icon">&#xe637;</i>&nbsp;&nbsp;日期
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="dropselect">
                                                        <i class="layui-icon">&#xe61a;</i>&nbsp;&nbsp;下拉框
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="desfield">
                                                        <i class="layui-icon">&#xe6b2;</i>&nbsp;&nbsp;描述
                                                    </div>
                                                </div>
                                                <!--<div class="layui-col-md6 fied-item">-->
                                                <!--<div class="grid-demo layui-bg-gray" templateName="pagination">-->
                                                <!--<i class="layui-icon">&#xe705;</i>&nbsp;&nbsp;分页-->
                                                <!--</div>-->
                                                <!--</div>-->
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="address">
                                                        <i class="layui-icon">&#xe62a;</i>&nbsp;&nbsp;地址
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="location">
                                                        <i class="layui-icon">&#xe715;</i>&nbsp;&nbsp;地理位置
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="urlfield">
                                                        <i class="layui-icon">&#xe64c;</i>&nbsp;&nbsp;网址
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="markfield">
                                                        <i class="layui-icon">&#xe606;</i>&nbsp;&nbsp;评分
                                                    </div>
                                                </div>

                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="multiselected">
                                                        <i class="layui-icon">&#xe65a;</i>&nbsp;&nbsp;两级下拉框
                                                    </div>
                                                </div>
                                                <div class="layui-col-md6 fied-item">
                                                    <div class="grid-demo layui-bg-gray" templateName="uploadfile">
                                                        <i class="layui-icon">&#xe624;</i>&nbsp;&nbsp;上传文件
                                                    </div>
                                                </div>

                                                <!--单行文字 多行文字 单项选择 多项选择 图片单选 图片多选 矩阵单选 矩阵填空 数字 时间 日期 下拉框 描述 分页 网址 评分 两级下拉框 上传文件 表单管理-->

                                            </div>

                                        </div>
                                        <div class="layui-tab-item">
                                            <form class="layui-form">
                                                <div id="editor"></div>
                                                <!--内容2 控制器-->
                                                <!--提交按钮-->
                                                <div class="layui-form-item leftfoot-btn">
                                                    <div class="layui-input-block">
                                                        <button class="layui-btn" lay-submit type="submit"
                                                                lay-filter="saveProp">
                                                            保存字段
                                                        </button>
                                                        <button class="layui-btn layui-btn-normal" id="saveForm">提交表单
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>

                                        </div>
                                        <div class="layui-tab-item">内容3</div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</nav>
</body>
<div th:include="/pages/templates::templates"></div>
<div th:include="/pages/templates::templatesEditor"></div>

<script type="text/html" id="img">
    <p><i class="layui-icon">&#xe624;</i>
        {{#if(d.type=='checkbox'){}}
        <input type="checkbox" name="prop[value][images][{{d.i}}][checked]"
               value="{{d.imgName}}" lay-skin="primary" title="默认选择" class="checked">
        {{#}else{}}
        <input type="radio" name="prop[value][checked]"
               value="{{d.imgName}}" lay-skin="primary" title="默认选择" class="checked">
        {{#}}}
        <img src="{{d.imgPath}}" style="width: 30px;height: 30px;"/>
        <input type="hidden" name="prop[value][images][{{d.i}}][imgPath]"
               value="{{d.imgPath}}"/><input type="text"
                                             name="prop[value][images][{{d.i}}][imgName]"
                                             class="select"
                                             value="{{d.imgName}}"
                                             placeholder="选项"/>
        <i class="layui-icon delImg">&#xe640;</i>
    </p>
</script>

<script th:src="@{/layui/layui.js}" type="text/javascript" charset="utf-8"></script>
<script th:src="@{/js/jquery-3.2.1.min.js}" type="text/javascript" charset="utf-8"></script>
<script th:src="@{/js/Util.js}" type="text/javascript" charset="utf-8"></script>
<script th:inline="javascript">
    var formId = [[${formDetail} == null ? '' : ${formDetail.form.id}]]
    ;
    var formProperties = [[${formDetail} == null ? '' : ${formDetail.formProperties}]]
    ;
</script>
<script type="text/javascript">
    var defaultProps = {
        singletext: {
            type: 'singletext',
            value: {
                verify: {
                    required: false,
                    min: {checked: false, val: ''},
                    max: {checked: false, val: ''},
                    msg: {checked: false, val: ''}
                },
                value: '',
                hasDefaultVal: true
            },
            name: '',
            des:
                ''
        },
        multitext: {
            type: 'multitext',
            value:
                {
                    verify: {
                        required: false,
                        min:
                            {
                                checked: false, val:
                                ''
                            }
                        ,
                        max: {
                            checked: false, val:
                                ''
                        }
                        ,
                        msg: {
                            checked: false, val:
                                ''
                        }
                    }
                    ,
                    value: '',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        singleselect: {
            type: 'singleselect',
            value:
                {
                    verify: {
                        required: false, msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    radios: {
                        1:
                            '选项1',
                        2:
                            '选项2',
                        3:
                            '选项3'
                    }
                    ,
                    checked: '选项1',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        multiselect: {
            type: 'multiselect',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                        ,
                        max: {
                            checked: false, val:
                                ''
                        }
                        ,
                        min: {
                            checked: false, val:
                                ''
                        }
                    }
                    ,
                    checkboxs: {
                        1:
                            {
                                value: '选项1', checked:
                                '选项1'
                            }
                        ,
                        2:
                            {
                                value: '选项2', checked:
                                ''
                            }
                        ,
                        3:
                            {
                                value: '选项3', checked:
                                ''
                            }
                        ,
                        4:
                            {
                                value: '选项4', checked:
                                ''
                            }
                    },
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        singlepic: {
            type: 'singlepic',
            value:
                {
                    verify: {
                        required: false, msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                checked: '',
                images:
                    {},
                hasDefaultVal: true
            }
            ,
            name: '',
            des:
                ''
        }
        ,
        multipic: {
            type: 'multipic',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                        ,
                        max: {
                            checked: false, val:
                                ''
                        }
                        ,
                        min: {
                            checked: false, val:
                                ''
                        }
                    }
                    ,
                images: {},
                hasDefaultVal: true
            }
            ,
            name: '',
            des:
                ''
        }
        ,
        singlemat: {
            type: 'singlemat',
            value:
                {
                    verify: {
                        required: false, msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    titles: {
                        1:
                            {
                                value: '題目1',
                                selects:
                                    {
                                        1:
                                            '项目1',
                                        2:
                                            '项目2',
                                        3:
                                            '项目3'
                                    }
                                ,
                            }
                        ,
                        2:
                            {
                                value: '題目2',
                                selects:
                                    {
                                        1:
                                            '项目1',
                                        2:
                                            '项目2',
                                        3:
                                            '项目3'
                                    }
                                ,
                            }
                        ,
                        3:
                            {
                                value: '題目3',
                                selects:
                                    {
                                        1:
                                            '项目1',
                                        2:
                                            '项目2',
                                        3:
                                            '项目3'
                                    }
                                ,
                            }
                    }
                    ,
                    selects: {
                        1:
                            '项目1',
                        2:
                            '项目2',
                        3:
                            '项目3'
                    }
                    ,
                    checked: '项目1',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        mattext: {
            type: 'mattext',
            value:
                {
                    verify: {
                        required: false, msg:
                            {
                                checked: false, val:
                                ''
                            }
                        ,
                        number: {
                            checked: false
                        }
                    }
                    ,
                    titles: {
                        1:
                            {
                                value: '題目',
                                selects:
                                    {
                                        1:
                                            '项目', 2:
                                        '项目', 3:
                                        '项目'
                                    }
                            }
                        ,
                        2:
                            {
                                value: '題目',
                                selects:
                                    {
                                        1:
                                            '项目', 2:
                                        '项目', 3:
                                        '项目'
                                    }
                            }
                        ,
                        3:
                            {
                                value: '題目',
                                selects:
                                    {
                                        1:
                                            '项目', 2:
                                        '项目', 3:
                                        '项目'
                                    }
                            }
                    }
                    ,
                    selects: {
                        1:
                            '项目', 2:
                            '项目', 3:
                            '项目'
                    }
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        numberfield: {
            type: 'numberfield',
            value:
                {
                    verify: {
                        required: false,
                        min:
                            {
                                checked: false, val:
                                ''
                            }
                        ,
                        max: {
                            checked: false, val:
                                ''
                        }
                        ,
                        msg: {
                            checked: false, val:
                                ''
                        }
                    }
                    ,
                    value: '',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        timepicker: {
            type: 'timepicker',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    hour: '',
                    minute:
                        '',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        datepicker: {
            type: 'datepicker',
            value:
                {
                    verify: {
                        required: false,
                        start:
                            {
                                type: '0', value:
                                '', val:
                                ''
                            }
                        ,
                        end: {
                            type: '0', value:
                                '', val:
                                ''
                        }
                        ,
                        msg: {
                            checked: false, val:
                                ''
                        }
                    }
                    ,
                    default:
                        {
                            type: '0', value:
                            '', val:
                            ''
                        }
                    , hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        dropselect: {
            type: 'dropselect',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    selects: {
                        1:
                            '选项', 2:
                            '选项'
                    }
                    ,
                    checked: '选项',
                    defaultslt:
                        '请选择',
                    value:
                        '',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        desfield: {
            type: 'desfield', name:
                '', des:
                ''
        }
        ,
        urlfield: {
            type: 'urlfield',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    value: '',
                    hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        address: {
            type: 'address',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        location: {
            type: 'location',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        markfield: {
            type: 'markfield',
            value:
                {
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    fullscore: '3',
                    icon:
                        '',
                    icons:
                        {
                            1:
                                '', 2:
                            '', 3:
                            ''
                        }
                    , hasDefaultVal: true
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        multiselected: {
            type: 'multiselected',
            value:
                {
                    hasDefaultVal: true,
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    select: {
                        fdefault: '请选择', sdefault:
                            '请选择'
                    }
                    ,
                    selects: {
                        1:
                            {
                                value: '一级选项', seconds:
                                {
                                    1:
                                        '二级选项', 2:
                                    '二级选项'
                                }
                            }
                        ,
                        2:
                            {
                                value: '一级选项', seconds:
                                {
                                    1:
                                        '二级选项', 2:
                                    '二级选项'
                                }
                            }
                    }
                }
            ,
            name: '',
            des:
                ''
        }
        ,
        uploadfile: {
            type: 'uploadfile',
            value:
                {
                    hasDefaultVal: true,
                    verify: {
                        required: false,
                        msg:
                            {
                                checked: false, val:
                                ''
                            }
                    }
                    ,
                    fileCount: '1',
                    fileType:
                        'file',
                    fileSize:
                        '15',
                    fileExts:
                        ''
                }
            ,
            name: '',
            des:
                ''
        }
    }
    var index = 1;
    layui.use(['element', 'layedit', 'form', 'laytpl', 'upload', 'laydate'], function () {
        var element = layui.element;
        var layedit = layui.layedit;
        var upload = layui.upload;
        var laydate = layui.laydate;
        window.form = layui.form;
        var laytpl = layui.laytpl;
        var editOptions = {
            height: 100,
            tool: [
                'strong' //加粗
                , 'italic' //斜体
                , 'underline' //下划线
                , 'del' //删除线
                , '|' //分割线
                , 'left' //左对齐
                , 'center' //居中对齐
                , 'right' //右对齐
                , 'link' //超链接
                , 'unlink' //清除链接
                , 'face' //表情
            ]
        }, edit;
        var $editor = $('#editor').on('click', '.addselect', function () {
            var parentNode = this.parentNode, elem = parentNode.cloneNode(true);
            var date = new Date().getTime(), name, rapStr;
            $(elem).find('input').each(function () {
                if ($(this).attr('type') != 'radio') {
                    name = $(this).attr('name');
                    $(this).attr('name', name.replace(/([0-9]+)/g, date));
                }
            });
            $(parentNode).after(elem);

            form.render('radio');
            form.render('checkbox');
        }).on('click', '.delselect', function () {
            this.parentNode && this.parentNode.remove();
        }).on('blur', '.select', function () {
            $(this.parentNode).find('.checked').val($(this).val());
        }).on('click', '.delImg', function () {
            var parentNode = this.parentNode;
            var imgPath = $(parentNode).find('img').attr('src');
            parentNode && parentNode.remove();
            $.get('/formValue/delImg', {imgPath: imgPath});
        }).on('change', '.date', function () {
            $('#' + $(this).attr('to')).val($(this).val());
        }).on('click', '.markicon', function () {
            var icon = $(this).index() - 1;
            $('.markicon').each(function (i) {
                if (i == icon) this.style.color = '#FFAC21';
                else $(this).removeAttr('style');
            });
            $('#icon').val(icon + 1);
        });
        form.on('select(fileTypeslt)', function (data) {
            var fileTypeslt = $(data.elem).val();
            var $file = $('#file');
            if (fileTypeslt == 'file') {
                $file.show();
            } else {
                $file.hide();
                $file.find('input').val('');
            }
        });
        form.on('select(dateslt)', function (data) {
            var $elem = $(data.elem.parentNode.nextSibling.nextSibling);
            $elem.children().hide();
            $elem.find('input').val('');
            $elem.find('#' + data.value).show();
        });
        var $form = $('.formEditorView>div>form').on('click', '.new-line', function (e) {
            if (!e.isDefaultPrevented()) {
                $('.new-line').removeClass('active-line');
                var $this = $(this);
                var thisProp = $this.data('prop');
                $this.addClass('active-line');
                var $template = $('#' + $this.attr('editor') + "editor");
                $editor.html('');
                thisProp && $template && laytpl($template.html()).render(thisProp, function (html) {
                    $editor.html(html);
                    $editor.find('input[placeholder="yyyy-MM-dd"]').each(function (i, elem) {
                        laydate.render({
                            elem: elem,
                            done: function (value, date, endDate) {
                                $('#' + $(elem).attr('to')).val(value);
                            }
                        });
                    });
                    layedit.setContent(layedit.build($editor.find('textarea')[0], editOptions), thisProp.des);
                    form.render();
                    $('#editorTab').click();
                });
                $('#uploadImgs') && upload.render({
                    elem: '#uploadImgs',
                    url: '/formValue/uploadImg',
                    fileCount: 5,
                    multiple: true,
                    drag: true,
                    done: function (res) {
                        laytpl(img.innerHTML).render($.extend({}, res.data, {
                            type: $this.attr('editor') == 'multipic' ? 'checkbox' : 'radio',
                            i: new Date().getTime()
                        }), function (html) {
                            $('#imgs').append(html)
                        });
                        form.render();
                    }
                });
            }
        }).on('click', '.ele-copy', function (e) {
            e.preventDefault();
            var ele = (this.parentNode && this.parentNode.parentNode && this.parentNode.parentNode.cloneNode(true));
            if (!ele) {
                alert('发生错误');
            } else {
                var prop = $.extend(true, {}, $(this.parentNode.parentNode).data('prop'));
                delete prop.id;
                prop.name = prop.name.replace(/[0-9]+/, index);
                $(ele).data('prop', prop);
                var $curElem = $('.active-line');
                $curElem.removeClass('active-line');
                $curElem.after($(ele));
            }
        }).on('click', '.ele-del', function (e) {
            e.preventDefault();
            var new_line = this.parentNode.parentNode;
            var prop = $(new_line).data('prop');
            if (prop.type == 'singlepic' || prop.type == 'multipic') {
                layui.each(prop.value.images, function (i) {
                    $.get('/formValue/delImg', {imgPath: prop.value.images[i].imgPath});
                });
            }
            $(new_line).removeData('prop');
            var pre_new_line = $(new_line).prev()[0];
            if (pre_new_line) $(pre_new_line).click();
            (this.parentNode && new_line && new_line.remove());
        });
        formProperties && layui.each(formProperties, function () {
            var _this = this;
            _this.default = true;
            _this.value = JSON.parse(_this.value);
            laytpl($('#' + _this.type).html()).render(_this, function (html) {
                var $html = $(html);
                $html.data('prop', _this);
                $form.append($html);
                form.render();
            });
        });
        var formDes = layedit.build('briefText', {
            height: 150,
            tool: editOptions.tool
        }); //建立编辑器
        $('.add-field .grid-demo').click(function () {
            var tplId = $(this).attr('templateName');
            var defaultProp = $.extend(false, {}, defaultProps[tplId], {
                name: '未命名' + index++,
                des: '描述',
                default: true
            });
            //可以为每一个配置都设置一个默认的配置对象，需要先定义。
            laytpl($('#' + tplId).html()).render(defaultProp, function (html) {
                var $html = $(html);
                $html.data('prop', defaultProp);
                $('.new-line').removeClass('active-line');
                $html.addClass('active-line');
                var $activeLine = $form.find('.active-line');
                $activeLine.length ? $activeLine.after($html) : $form.append($html);
                form.render();
            });
        });
        form.on('submit(saveProp)', function (data) {
            var $thisElem = $('.active-line');
            var type = $thisElem.attr('editor');
            if (!$thisElem.length || !type) return false;
            var prop = {value: {verify: {required: false}}, default: true, type: type, id: $thisElem.data('prop').id};
            prop.value.verify = $.extend(true, {}, defaultProps[type].value.verify);
            prop.value.hasDefaultVal = defaultProps[type].value.hasDefaultVal;
            if (type == 'markfield') prop.value.icons = $.extend(true, {}, defaultProps[type].value.icons);
            var field, name, k;
            for (var key in data.field) {
                k = key;
                key = key.replace(/(\[|])/g, function (word) {
                    return word == '[' ? '["' : '"]';
                });
                parse(prop, key);
                eval(key + '="' + data.field[k] + '"');
            }
            // prop.des = data.field.des;
            if (type == 'singlemat' || type == 'mattext') {
                for (var key in prop.value.titles) {
                    prop.value.titles[key].selects = $.extend(true, {}, prop.value.selects);
                }
            }
            if (type == 'datepicker') {
                var today = new Date();
                $([prop.value.default, prop.value.verify.start, prop.value.verify.end]).each(function () {
                    switch (this.type) {
                        case '0':
                            this.value = this.val;
                            break;
                        case'1':
                            this.value = today.Format('yyyy-MM-dd');
                            break;
                        case '2':
                            this.value = new Date(today.setDate(today.getDate() - parseInt(this.val))).Format('yyyy-MM-dd');
                            break;
                        case'3':
                            this.value = new Date(today.setDate(today.getDate() + parseInt(this.val))).Format('yyyy-MM-dd');
                            break;
                    }
                });
            }
            laytpl($('#' + prop.type).html()).render(prop, function (html) {
                var $html = $(html);
                $html.data('prop', prop);
                $html.addClass('active-line');
                $thisElem.replaceWith($html);
                form.render();
            });
            return false;
        });
        var parse = function (prop, key) {
            var reg = /\[/g, field, name;
            while (reg.exec(key)) {
                name = key.substring(0, reg.lastIndex - 1);
                field = eval(name);
                if (!field) eval(name + '={}');
            }
        };

        $('#saveForm').on('click', function () {
            var props = [], index, prop, form = {}, formDetail = {};
            form.id = formId;
            form.title = $('#formTitle').val();
            if (!form.title) {
                layer.msg("请填写表单名称", {
                    icon: 5
                    , shift: 6
                });
                return false;
            }
            form.des = layedit.getContent(formDes);
            $('#form').find('.new-line').each(function () {
                index = $(this).index();
                prop = $(this).data('prop');
                if (prop) {
                    delete prop.default;
                    prop.index = index;
                    prop.value = JSON.stringify(prop.value);
                    props.push(prop);
                }
            });
            formDetail.form = form;
            formDetail.formProperties = props;
            $.ajax({
                contentType: "application/json",
                dataType: 'json',
                type: "post",
                url: '/form/edit',
                data: JSON.stringify(formDetail),
                async: false,
                success: function (data) {
                    layer.msg('提交成功', {time: 3000});
                    window.location.href = '/form/desktop';
                }
            });
            return false;
        });
    });
</script>

</html>